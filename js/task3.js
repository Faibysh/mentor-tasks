import SimpleLightbox from"simplelightbox";import"simplelightbox/dist/simple-lightbox.min.css";import Notiflix from"notiflix";import api from"./getImages.js";import"../../style.css";const form=document.querySelector(".search-form"),gallery=document.querySelector(".gallery"),goTopButton=document.getElementById("go-top-button");let lightbox,hits={},perPage=20,queryPage=1,searchQuery="";async function onSearch(e){e.preventDefault(),queryPage=1;const t=e.currentTarget;searchQuery=t.elements.query.value.trim(),searchQuery?(clearHtml(),hits=await getQuery(),hits&&hits.numberOfTotalHits&&Notiflix.Notify.success(`Hurra! Znaleźliśmy ${hits.numberOfTotalHits} obrazów!`)):Notiflix.Notify.failure("Wprowadź frazę wyszukiwania!"),t.reset()}let endOfResultsNotified=!1;async function onLoadMore(){perPage*queryPage>=hits.numberOfTotalHits?endOfResultsNotified||(Notiflix.Notify.info("Przepraszamy, ale dotarłeś do końca wyników wyszukiwania."),endOfResultsNotified=!0):(queryPage+=1,lightbox&&lightbox.refresh())}async function getQuery(){try{if(hits=await api({perPage,queryPage,searchQuery}),void 0===hits.arrayOfHits||0===hits.arrayOfHits.length)throw new Error;const e=hits.arrayOfHits.reduce(((e,t)=>createPhotoCard(t)+e),"");return gallery.insertAdjacentHTML("beforeend",e),lightbox=new SimpleLightbox(".photo-link"),hits}catch(e){Notiflix.Notify.failure("Przepraszamy, nie ma obrazów pasujących do zapytania. Spróbuj ponownie.")}}function clearHtml(){gallery.innerHTML=""}function createPhotoCard({webformatURL:e,largeImageURL:t,tags:o}){return`\n    <li>\n      <a class="photo-link" href="${t}">\n        <img class="img" src="${e}" alt="${o}" />\n      </a>\n    </li>\n  `}const onClickTopHandler=e=>{e.preventDefault(),document.body.scrollTop=0,document.documentElement.scrollTop=0};goTopButton.addEventListener("click",onClickTopHandler),form.addEventListener("submit",onSearch),window.addEventListener("scroll",(e=>{const{scrollTop:t,scrollHeight:o,clientHeight:r}=document.documentElement;t+r>=o&&onLoadMore(),document.body.scrollTop>20||document.documentElement.scrollTop>20?goTopButton.classList.add("go-top-button-visible"):goTopButton.classList.remove("go-top-button-visible")}));export{form,gallery,goTopButton,hits,perPage,queryPage,searchQuery,onSearch,onLoadMore,getQuery,clearHtml,createPhotoCard};